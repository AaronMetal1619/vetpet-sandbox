services:
  backend:
    build:
      context: ./        # raÃ­z del backend
      dockerfile: Dockerfile
    container_name: laravel_app
    ports:
      - "8000:8088"
    volumes:
      - ./storage:/var/www/html/storage
      - ./public:/var/www/html/public
    environment:
      APACHE_DOCUMENT_ROOT: /var/www/html/public
    depends_on:
      - db

  db:
    image: mysql:8.0
    container_name: mysql_db
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: laravel
      MYSQL_USER: laravel
      MYSQL_PASSWORD: laravel
    ports:
      - "3307:3306"
    volumes:
      - dbdata:/var/lib/mysql

  frontend:
    build:
      context: ../vetpet-main-front     # ruta hacia tu front
      dockerfile: Dockerfile
    container_name: react_app
    ports:
      - "3000:80"
    volumes:
      - ../vetpet-main-front:/app
    depends_on:
      - backend

  superset:
    image: apache/superset:latest
    container_name: superset_app
    ports:
      - "8088:8088"                     # expone Superset
    volumes:
      - ./superset_config.py:/app/pythonpath/superset_config.py
    environment:
      SUPERSET_ENV: "production"
    command: >
      /bin/bash -c "
      superset db upgrade &&
      superset init &&
      superset run -p 8088 --with-threads --reload --debugger
      "
    depends_on:
      - db

volumes:
  dbdata:
